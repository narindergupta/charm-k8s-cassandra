version: 2
containers:
  - name: %(name)s
    image: %(docker_image)s
    imagePullPolicy: IfNotPresent
    ports:
      - containerPort: 7000
        name: intra-node
      - containerPort: 7001
        name: tls-intra-node
      - containerPort: 9042
        name: cql
    kubernetes:
      readinessProbe:
        exec:
          command:
          - /bin/bash
          - -c
          - /ready-probe.sh
        initialDelaySeconds: 15
        timeoutSeconds: 5
      securityContext:
        capabilities:
          add:
            - IPC_LOCK
    config:
      MAX_HEAP_SIZE: "512M"
      HEAP_NEWSIZE: "100M"
      CASSANDRA_CLUSTER_NAME: "K8Demo"
      CASSANDRA_DC: "DC1-K8Demo"
      CASSANDRA_RACK: "Rack1-K8Demo"
      CASSANDRA_SEEDS: "charm-k8s-cassandra-0.charm-k8s-cassandra-endpoints.cassandra.svc.cluster.local"
      POD_IP:
        field:
          path: status.podIP
